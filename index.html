<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deck Designer â€” Custom Skateboard Deck Graphics</title>
<meta name="description" content="Design custom skateboard deck graphics right in your browser. Choose shapes, colors, patterns, text, and export your design as a PNG.">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›¹</text></svg>">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--surface:#14141f;--surface2:#1e1e2e;--accent:#a855f7;--accent2:#ec4899;--text:#e2e2f0;--text2:#8888a0;--radius:12px}
body{background:var(--bg);color:var(--text);font-family:'Segoe UI',system-ui,sans-serif;min-height:100vh;display:flex;flex-direction:column}
header{text-align:center;padding:24px 16px 8px}
header h1{font-size:1.8rem;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:800}
header p{color:var(--text2);font-size:.9rem;margin-top:4px}
.app{display:flex;gap:16px;padding:16px;flex:1;max-width:1200px;margin:0 auto;width:100%}
.toolbar{width:240px;display:flex;flex-direction:column;gap:12px;flex-shrink:0}
.panel{background:var(--surface);border-radius:var(--radius);padding:14px}
.panel h3{font-size:.75rem;text-transform:uppercase;letter-spacing:.08em;color:var(--text2);margin-bottom:10px}
.canvas-wrap{flex:1;display:flex;align-items:center;justify-content:center;background:var(--surface);border-radius:var(--radius);overflow:hidden;position:relative}
canvas{cursor:crosshair}
.color-row{display:flex;gap:6px;flex-wrap:wrap}
.color-swatch{width:28px;height:28px;border-radius:6px;cursor:pointer;border:2px solid transparent;transition:.15s}
.color-swatch:hover,.color-swatch.active{border-color:#fff;transform:scale(1.15)}
.btn{display:block;width:100%;padding:10px;border:none;border-radius:8px;cursor:pointer;font-size:.85rem;font-weight:600;transition:.15s}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff}
.btn-primary:hover{opacity:.9;transform:translateY(-1px)}
.btn-secondary{background:var(--surface2);color:var(--text)}
.btn-secondary:hover{background:#2a2a3e}
.tools-row{display:flex;gap:6px;flex-wrap:wrap}
.tool-btn{padding:8px 12px;background:var(--surface2);border:2px solid transparent;border-radius:8px;cursor:pointer;font-size:1.1rem;transition:.15s;color:var(--text)}
.tool-btn:hover{background:#2a2a3e}
.tool-btn.active{border-color:var(--accent);background:#2a1a3e}
label{display:block;font-size:.8rem;color:var(--text2);margin:8px 0 4px}
input[type=range]{width:100%;accent-color:var(--accent)}
input[type=text]{width:100%;padding:8px;background:var(--surface2);border:1px solid #333;border-radius:6px;color:var(--text);font-size:.85rem}
select{width:100%;padding:8px;background:var(--surface2);border:1px solid #333;border-radius:6px;color:var(--text);font-size:.85rem}
.sticker-row{display:flex;gap:6px;flex-wrap:wrap}
.sticker-btn{font-size:1.6rem;background:var(--surface2);border:none;border-radius:8px;padding:6px 10px;cursor:pointer;transition:.15s}
.sticker-btn:hover{background:#2a2a3e;transform:scale(1.1)}
.gallery-item{position:relative;background:var(--surface2);border-radius:8px;padding:6px;cursor:pointer;transition:.15s}
.gallery-item:hover{background:#2a2a3e}
.gallery-item img{width:100%;border-radius:4px}
.gallery-item .gallery-name{font-size:.7rem;color:var(--text2);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.gallery-item .gallery-del{position:absolute;top:4px;right:4px;background:rgba(0,0,0,.6);border:none;color:#f66;font-size:.7rem;border-radius:4px;cursor:pointer;padding:1px 5px}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:var(--accent);color:#fff;padding:10px 24px;border-radius:8px;font-size:.9rem;font-weight:600;z-index:999;opacity:0;transition:opacity .3s}
.toast.show{opacity:1}
@media(max-width:768px){.app{flex-direction:column}.toolbar{width:100%;flex-direction:row;flex-wrap:wrap}.panel{flex:1;min-width:140px}}
</style>
</head>
<body>
<header>
  <h1>ğŸ›¹ Deck Designer</h1>
  <p>Design custom skateboard deck graphics â€” no account needed</p>
</header>
<div class="app">
  <div class="toolbar">
    <div class="panel">
      <h3>Tools</h3>
      <div class="tools-row">
        <button class="tool-btn active" data-tool="brush" title="Brush">ğŸ–Œï¸</button>
        <button class="tool-btn" data-tool="line" title="Line">ğŸ“</button>
        <button class="tool-btn" data-tool="rect" title="Rectangle">â¬œ</button>
        <button class="tool-btn" data-tool="circle" title="Circle">â­•</button>
        <button class="tool-btn" data-tool="spray" title="Spray Paint">ğŸ’¨</button>
        <button class="tool-btn" data-tool="fill" title="Fill">ğŸª£</button>
        <button class="tool-btn" data-tool="eraser" title="Eraser">ğŸ§¹</button>
        <button class="tool-btn" data-tool="text" title="Text">ğŸ”¤</button>
        <button class="tool-btn" data-tool="sticker" title="Sticker">ğŸ¨</button>
        <button class="tool-btn" data-tool="image" title="Place Image">ğŸ–¼ï¸</button>
      </div>
    </div>
    <div class="panel">
      <h3>Colors</h3>
      <div class="color-row" id="colors"></div>
      <label>Custom <input type="color" id="customColor" value="#a855f7" style="width:100%;height:30px;border:none;background:none;cursor:pointer;margin-top:4px"></label>
    </div>
    <div class="panel">
      <h3>Brush Size</h3>
      <input type="range" id="brushSize" min="1" max="40" value="6">
      <span id="brushSizeVal" style="font-size:.8rem;color:var(--text2)">6px</span>
    </div>
    <div class="panel" id="textPanel" style="display:none">
      <h3>Text Options</h3>
      <input type="text" id="textInput" placeholder="Type text...">
      <label>Font Size</label>
      <input type="range" id="fontSize" min="12" max="80" value="32">
      <label>Font</label>
      <select id="fontFamily">
        <option value="Impact">Impact</option>
        <option value="Arial Black">Arial Black</option>
        <option value="Courier New">Courier New</option>
        <option value="Georgia">Georgia</option>
        <option value="Comic Sans MS">Comic Sans MS</option>
      </select>
    </div>
    <div class="panel" id="sprayPanel" style="display:none">
      <h3>Spray Paint</h3>
      <label>Radius</label>
      <input type="range" id="sprayRadius" min="10" max="80" value="30">
      <span id="sprayRadiusVal" style="font-size:.8rem;color:var(--text2)">30px</span>
      <label>Density</label>
      <input type="range" id="sprayDensity" min="5" max="60" value="25">
      <span id="sprayDensityVal" style="font-size:.8rem;color:var(--text2)">25</span>
    </div>
    <div class="panel" id="stickerPanel" style="display:none">
      <h3>Stickers</h3>
      <div class="sticker-row">
        <button class="sticker-btn" data-sticker="ğŸ›¹">ğŸ›¹</button>
        <button class="sticker-btn" data-sticker="ğŸ’€">ğŸ’€</button>
        <button class="sticker-btn" data-sticker="ğŸ”¥">ğŸ”¥</button>
        <button class="sticker-btn" data-sticker="âš¡">âš¡</button>
        <button class="sticker-btn" data-sticker="ğŸ‘½">ğŸ‘½</button>
        <button class="sticker-btn" data-sticker="ğŸ">ğŸ</button>
        <button class="sticker-btn" data-sticker="ğŸŒ¹">ğŸŒ¹</button>
        <button class="sticker-btn" data-sticker="â­">â­</button>
        <button class="sticker-btn" data-sticker="ğŸ¯">ğŸ¯</button>
        <button class="sticker-btn" data-sticker="ğŸ¦…">ğŸ¦…</button>
        <button class="sticker-btn" data-sticker="ğŸ‰">ğŸ‰</button>
        <button class="sticker-btn" data-sticker="â˜ ï¸">â˜ ï¸</button>
      </div>
    </div>
    <div class="panel" id="imagePanel" style="display:none">
      <h3>Image Upload</h3>
      <input type="file" id="imageUpload" accept="image/*" style="width:100%;font-size:.8rem;color:var(--text2);margin-bottom:8px">
      <div id="imagePreview" style="display:none;margin-bottom:8px;text-align:center">
        <img id="imageThumb" style="max-width:100%;max-height:80px;border-radius:6px;border:1px solid #333">
      </div>
      <label>Mode</label>
      <select id="imageMode" style="margin-bottom:6px">
        <option value="sticker">Place as Sticker (click to place)</option>
        <option value="background">Fill as Background</option>
      </select>
      <label>Sticker Size</label>
      <input type="range" id="imageSize" min="20" max="300" value="80">
      <span id="imageSizeVal" style="font-size:.8rem;color:var(--text2)">80px</span>
      <button class="btn btn-secondary" id="applyImageBg" style="margin-top:8px;display:none" onclick="applyImageBackground()">Apply as Background</button>
    </div>
    <div class="panel">
      <h3>Background</h3>
      <div class="color-row" id="bgColors"></div>
      <button class="btn btn-secondary" onclick="fillDeckGradient()" style="margin-top:8px">Random Gradient</button>
    </div>
    <div class="panel">
      <h3>Preset Templates</h3>
      <div style="display:flex;flex-direction:column;gap:6px">
        <button class="btn btn-secondary" onclick="applyTemplate('flames')">ğŸ”¥ Flames</button>
        <button class="btn btn-secondary" onclick="applyTemplate('camo')">ğŸŒ¿ Camo</button>
        <button class="btn btn-secondary" onclick="applyTemplate('geometric')">ğŸ”· Geometric</button>
        <button class="btn btn-secondary" onclick="applyTemplate('lightning')">âš¡ Lightning</button>
        <button class="btn btn-secondary" onclick="applyTemplate('waves')">ğŸŒŠ Waves</button>
        <button class="btn btn-secondary" onclick="applyTemplate('stars')">âœ¨ Starfield</button>
      </div>
    </div>
    <div class="panel" style="display:flex;flex-direction:column;gap:8px">
      <button class="btn btn-secondary" onclick="clearCanvas()">Clear Canvas</button>
      <button class="btn btn-secondary" onclick="undoLast()">â†© Undo</button>
      <button class="btn btn-primary" onclick="exportPNG()">ğŸ’¾ Export PNG</button>
    </div>
    <div class="panel" style="display:flex;flex-direction:column;gap:8px">
      <h3>Gallery</h3>
      <button class="btn btn-primary" onclick="shareDesign()">ğŸ”— Share Link</button>
      <button class="btn btn-secondary" onclick="saveToGallery()">ğŸ“Œ Save to Gallery</button>
      <div id="galleryList" style="display:flex;flex-direction:column;gap:6px;margin-top:4px;max-height:300px;overflow-y:auto"></div>
    </div>
  </div>
  <div class="canvas-wrap">
    <canvas id="deck" width="320" height="820"></canvas>
  </div>
</div>
<script>
const C=document.getElementById('deck'),ctx=C.getContext('2d');
const COLORS=['#ffffff','#000000','#e53e3e','#dd6b20','#ecc94b','#38a169','#3182ce','#805ad5','#d53f8c','#4fd1c2','#a0aec0','#2d3748'];
const BG_COLORS=['#000000','#1a1a2e','#0f3460','#16213e','#1b1b2f','#2d132c','#ffffff','#f5f5dc'];
let tool='brush',color='#a855f7',brushSize=6,drawing=false,startX,startY,history=[],selectedSticker='ğŸ›¹';

function initColors(id,colors,onClick){
  const el=document.getElementById(id);
  colors.forEach((c,i)=>{
    const s=document.createElement('div');
    s.className='color-swatch'+(i===0?' active':'');
    s.style.background=c;
    s.onclick=()=>{onClick(c);el.querySelectorAll('.color-swatch').forEach(x=>x.classList.remove('active'));s.classList.add('active')};
    el.appendChild(s);
  });
}
initColors('colors',COLORS,c=>{color=c;document.getElementById('customColor').value=c});
initColors('bgColors',BG_COLORS,c=>fillDeckBg(c));
document.getElementById('customColor').oninput=e=>color=e.target.value;
document.getElementById('brushSize').oninput=e=>{brushSize=+e.target.value;document.getElementById('brushSizeVal').textContent=e.target.value+'px'};

document.querySelectorAll('.tool-btn').forEach(b=>b.onclick=()=>{
  document.querySelectorAll('.tool-btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');tool=b.dataset.tool;
  document.getElementById('textPanel').style.display=tool==='text'?'block':'none';
  document.getElementById('stickerPanel').style.display=tool==='sticker'?'block':'none';
  document.getElementById('sprayPanel').style.display=tool==='spray'?'block':'none';
  document.getElementById('imagePanel').style.display=tool==='image'?'block':'none';
});
document.querySelectorAll('.sticker-btn').forEach(b=>b.onclick=()=>selectedSticker=b.dataset.sticker);
document.getElementById('sprayRadius').oninput=e=>document.getElementById('sprayRadiusVal').textContent=e.target.value+'px';
document.getElementById('sprayDensity').oninput=e=>document.getElementById('sprayDensityVal').textContent=e.target.value;

let sprayInterval=null;
function sprayPaint(x,y){
  const radius=+document.getElementById('sprayRadius').value;
  const density=+document.getElementById('sprayDensity').value;
  ctx.save();deckClip();
  ctx.fillStyle=color;
  for(let i=0;i<density;i++){
    const angle=Math.random()*Math.PI*2;
    const r=Math.random()*radius;
    const px=x+Math.cos(angle)*r;
    const py=y+Math.sin(angle)*r;
    const size=0.5+Math.random()*2;
    ctx.globalAlpha=0.15+Math.random()*0.45;
    ctx.beginPath();ctx.arc(px,py,size,0,Math.PI*2);ctx.fill();
  }
  ctx.restore();ctx.globalAlpha=1;drawDeckOutline();
}

function saveState(){history.push(C.toDataURL());if(history.length>30)history.shift()}
function undoLast(){if(history.length){const img=new Image();img.onload=()=>{ctx.clearRect(0,0,C.width,C.height);ctx.drawImage(img,0,0)};img.src=history.pop()}}

// Draw deck shape
function deckPath(){
  const w=C.width,h=C.height,r=w/2,nose=80,tail=70;
  ctx.beginPath();
  ctx.moveTo(r,0);
  ctx.bezierCurveTo(w+20,nose,-20,nose,r,0);// nose curve (top)
  // Actually let's do a proper deck outline
  ctx.closePath();
}

function fillDeckBg(c){saveState();ctx.save();deckClip();ctx.fillStyle=c;ctx.fillRect(0,0,C.width,C.height);ctx.restore();restoreDrawing()}
function fillDeckGradient(){
  saveState();
  const g=ctx.createLinearGradient(0,0,C.width,C.height);
  const rc=()=>COLORS[Math.floor(Math.random()*COLORS.length)];
  g.addColorStop(0,rc());g.addColorStop(.5,rc());g.addColorStop(1,rc());
  ctx.save();deckClip();ctx.fillStyle=g;ctx.fillRect(0,0,C.width,C.height);ctx.restore();restoreDrawing();
}

let drawingData=null;
function restoreDrawing(){
  if(drawingData){const img=new Image();img.onload=()=>ctx.drawImage(img,0,0);img.src=drawingData}
}

function deckClip(){
  const w=C.width,h=C.height,r=w/2;
  ctx.beginPath();
  // Nose (top)
  ctx.moveTo(20,100);
  ctx.quadraticCurveTo(20,10,r,8);
  ctx.quadraticCurveTo(w-20,10,w-20,100);
  // Right side
  ctx.lineTo(w-10,h-100);
  // Tail (bottom)
  ctx.quadraticCurveTo(w-15,h-10,r,h-5);
  ctx.quadraticCurveTo(15,h-10,10,h-100);
  // Left side
  ctx.lineTo(20,100);
  ctx.closePath();
  ctx.clip();
}

function initDeck(){
  ctx.save();deckClip();
  ctx.fillStyle='#1a1a2e';ctx.fillRect(0,0,C.width,C.height);
  ctx.restore();
  // Draw outline
  drawDeckOutline();
}

function drawDeckOutline(){
  const w=C.width,h=C.height,r=w/2;
  ctx.save();
  ctx.strokeStyle='#333';ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(20,100);
  ctx.quadraticCurveTo(20,10,r,8);
  ctx.quadraticCurveTo(w-20,10,w-20,100);
  ctx.lineTo(w-10,h-100);
  ctx.quadraticCurveTo(w-15,h-10,r,h-5);
  ctx.quadraticCurveTo(15,h-10,10,h-100);
  ctx.lineTo(20,100);
  ctx.closePath();ctx.stroke();ctx.restore();
}

function clearCanvas(){saveState();ctx.clearRect(0,0,C.width,C.height);initDeck()}

let tempCanvas,tempCtx;
function initTemp(){tempCanvas=document.createElement('canvas');tempCanvas.width=C.width;tempCanvas.height=C.height;tempCtx=tempCanvas.getContext('2d')}
initTemp();

let snapshot=null;
C.addEventListener('mousedown',e=>{
  const rect=C.getBoundingClientRect();
  const sx=C.width/rect.width,sy=C.height/rect.height;
  startX=(e.clientX-rect.left)*sx;startY=(e.clientY-rect.top)*sy;
  
  if(tool==='text'){
    saveState();
    const txt=document.getElementById('textInput').value||'SKATE';
    const fs=document.getElementById('fontSize').value;
    const ff=document.getElementById('fontFamily').value;
    ctx.save();deckClip();
    ctx.font=`bold ${fs}px ${ff}`;ctx.fillStyle=color;ctx.textAlign='center';
    ctx.fillText(txt,startX,startY);
    ctx.restore();drawDeckOutline();return;
  }
  if(tool==='sticker'){
    saveState();ctx.save();deckClip();
    ctx.font='48px serif';ctx.textAlign='center';
    ctx.fillText(selectedSticker,startX,startY);
    ctx.restore();drawDeckOutline();return;
  }
  if(tool==='image'){
    if(uploadedImage&&document.getElementById('imageMode').value==='sticker'){
      placeImageSticker(startX,startY);
    }
    return;
  }
  if(tool==='spray'){
    saveState();sprayPaint(startX,startY);
    sprayInterval=setInterval(()=>sprayPaint(startX,startY),30);
    drawing=true;return;
  }
  if(tool==='fill'){
    saveState();ctx.save();deckClip();ctx.fillStyle=color;ctx.fillRect(0,0,C.width,C.height);ctx.restore();drawDeckOutline();return;
  }
  
  drawing=true;saveState();
  snapshot=ctx.getImageData(0,0,C.width,C.height);
  if(tool==='brush'||tool==='eraser'){
    ctx.beginPath();ctx.moveTo(startX,startY);
  }
});

C.addEventListener('mousemove',e=>{
  if(!drawing)return;
  const rect=C.getBoundingClientRect();
  const sx=C.width/rect.width,sy=C.height/rect.height;
  const x=(e.clientX-rect.left)*sx,y=(e.clientY-rect.top)*sy;
  
  if(tool==='spray'){
    startX=x;startY=y;
    sprayPaint(x,y);return;
  }
  if(tool==='brush'||tool==='eraser'){
    ctx.save();deckClip();
    ctx.lineWidth=brushSize;ctx.lineCap='round';ctx.lineJoin='round';
    if(tool==='eraser'){ctx.globalCompositeOperation='destination-out'}
    ctx.strokeStyle=color;
    ctx.lineTo(x,y);ctx.stroke();
    ctx.restore();drawDeckOutline();
  } else {
    ctx.putImageData(snapshot,0,0);
    ctx.save();deckClip();ctx.strokeStyle=color;ctx.fillStyle=color;ctx.lineWidth=brushSize;
    if(tool==='line'){ctx.beginPath();ctx.moveTo(startX,startY);ctx.lineTo(x,y);ctx.stroke()}
    if(tool==='rect'){ctx.strokeRect(Math.min(startX,x),Math.min(startY,y),Math.abs(x-startX),Math.abs(y-startY))}
    if(tool==='circle'){const rx=Math.abs(x-startX)/2,ry=Math.abs(y-startY)/2;ctx.beginPath();ctx.ellipse(startX+((x-startX)/2),startY+((y-startY)/2),rx,ry,0,0,Math.PI*2);ctx.stroke()}
    ctx.restore();drawDeckOutline();
  }
});

C.addEventListener('mouseup',()=>{drawing=false;ctx.beginPath();if(sprayInterval){clearInterval(sprayInterval);sprayInterval=null}});
C.addEventListener('mouseleave',()=>{drawing=false;ctx.beginPath();if(sprayInterval){clearInterval(sprayInterval);sprayInterval=null}});

// Touch support
C.addEventListener('touchstart',e=>{e.preventDefault();const t=e.touches[0];C.dispatchEvent(new MouseEvent('mousedown',{clientX:t.clientX,clientY:t.clientY}))},{passive:false});
C.addEventListener('touchmove',e=>{e.preventDefault();const t=e.touches[0];C.dispatchEvent(new MouseEvent('mousemove',{clientX:t.clientX,clientY:t.clientY}))},{passive:false});
C.addEventListener('touchend',e=>{e.preventDefault();C.dispatchEvent(new MouseEvent('mouseup'))},{passive:false});

function exportPNG(){
  const a=document.createElement('a');a.download='deck-design.png';a.href=C.toDataURL('image/png');a.click();
}

function applyTemplate(name){
  saveState();
  ctx.clearRect(0,0,C.width,C.height);
  ctx.save();deckClip();
  const w=C.width,h=C.height;
  
  if(name==='flames'){
    // Dark bg with fire gradient
    const bg=ctx.createLinearGradient(0,h,0,0);
    bg.addColorStop(0,'#ff4500');bg.addColorStop(.3,'#ff6600');bg.addColorStop(.6,'#1a0a00');bg.addColorStop(1,'#000');
    ctx.fillStyle=bg;ctx.fillRect(0,0,w,h);
    // Draw flame shapes
    for(let i=0;i<12;i++){
      const fx=Math.random()*w,fy=h-Math.random()*h*0.7;
      const fh=80+Math.random()*200,fw=20+Math.random()*40;
      const fg=ctx.createLinearGradient(fx,fy,fx,fy-fh);
      fg.addColorStop(0,'rgba(255,69,0,0.8)');fg.addColorStop(.4,'rgba(255,165,0,0.6)');fg.addColorStop(.7,'rgba(255,255,0,0.3)');fg.addColorStop(1,'rgba(255,255,0,0)');
      ctx.fillStyle=fg;
      ctx.beginPath();
      ctx.moveTo(fx-fw/2,fy);
      ctx.quadraticCurveTo(fx-fw/3,fy-fh*0.5,fx+Math.random()*10-5,fy-fh);
      ctx.quadraticCurveTo(fx+fw/3,fy-fh*0.5,fx+fw/2,fy);
      ctx.fill();
    }
  }
  else if(name==='camo'){
    ctx.fillStyle='#4a5d23';ctx.fillRect(0,0,w,h);
    const camoColors=['#2d3a0f','#6b7c3e','#3b4a1a','#1a2508','#8a9955'];
    for(let i=0;i<35;i++){
      ctx.fillStyle=camoColors[Math.floor(Math.random()*camoColors.length)];
      ctx.beginPath();
      const cx=Math.random()*w,cy=Math.random()*h;
      ctx.moveTo(cx,cy);
      for(let j=0;j<6;j++){
        const angle=j/6*Math.PI*2;
        const r=30+Math.random()*50;
        ctx.quadraticCurveTo(cx+Math.cos(angle)*r*1.3,cy+Math.sin(angle)*r*1.3,
          cx+Math.cos(angle+Math.PI/6)*r,cy+Math.sin(angle+Math.PI/6)*r);
      }
      ctx.closePath();ctx.fill();
    }
  }
  else if(name==='geometric'){
    ctx.fillStyle='#0d0d1a';ctx.fillRect(0,0,w,h);
    const geoColors=['#a855f7','#ec4899','#3b82f6','#10b981','#f59e0b'];
    // Draw triangles and shapes
    for(let i=0;i<20;i++){
      ctx.strokeStyle=geoColors[Math.floor(Math.random()*geoColors.length)];
      ctx.lineWidth=1.5+Math.random()*2;
      ctx.globalAlpha=0.4+Math.random()*0.5;
      const cx=Math.random()*w,cy=Math.random()*h,size=30+Math.random()*70;
      const sides=3+Math.floor(Math.random()*4);
      ctx.beginPath();
      for(let s=0;s<=sides;s++){
        const a=s/sides*Math.PI*2-Math.PI/2;
        const px=cx+Math.cos(a)*size,py=cy+Math.sin(a)*size;
        s===0?ctx.moveTo(px,py):ctx.lineTo(px,py);
      }
      ctx.closePath();
      if(Math.random()>0.5){ctx.fillStyle=ctx.strokeStyle;ctx.globalAlpha*=0.3;ctx.fill();ctx.globalAlpha=1}
      ctx.stroke();
    }
    // Connecting lines
    ctx.globalAlpha=0.15;ctx.strokeStyle='#a855f7';ctx.lineWidth=0.5;
    for(let i=0;i<15;i++){
      ctx.beginPath();ctx.moveTo(Math.random()*w,Math.random()*h);ctx.lineTo(Math.random()*w,Math.random()*h);ctx.stroke();
    }
    ctx.globalAlpha=1;
  }
  else if(name==='lightning'){
    const lbg=ctx.createLinearGradient(0,0,0,h);
    lbg.addColorStop(0,'#0a001a');lbg.addColorStop(1,'#1a0033');
    ctx.fillStyle=lbg;ctx.fillRect(0,0,w,h);
    for(let b=0;b<5;b++){
      let bx=Math.random()*w,by=10;
      ctx.strokeStyle=`rgba(180,160,255,${0.3+Math.random()*0.5})`;ctx.lineWidth=1+Math.random()*2;
      ctx.shadowColor='#8b5cf6';ctx.shadowBlur=15;
      ctx.beginPath();ctx.moveTo(bx,by);
      while(by<h-20){
        bx+=Math.random()*50-25;by+=15+Math.random()*30;
        ctx.lineTo(bx,by);
        if(Math.random()>0.7){const sx=bx,sy=by;ctx.moveTo(sx,sy);
          ctx.lineTo(sx+Math.random()*40-20,sy+20+Math.random()*20);ctx.moveTo(sx,sy)}
      }
      ctx.stroke();ctx.shadowBlur=0;
    }
  }
  else if(name==='waves'){
    const wbg=ctx.createLinearGradient(0,0,0,h);
    wbg.addColorStop(0,'#001220');wbg.addColorStop(1,'#001a33');
    ctx.fillStyle=wbg;ctx.fillRect(0,0,w,h);
    for(let i=0;i<18;i++){
      const yy=i*h/18;
      ctx.strokeStyle=`hsla(${190+i*5},80%,${40+i*2}%,0.4)`;ctx.lineWidth=2;
      ctx.beginPath();
      for(let x=0;x<=w;x+=5){
        const y=yy+Math.sin(x*0.03+i*0.8)*20+Math.sin(x*0.01+i)*10;
        x===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
      }
      ctx.stroke();
    }
  }
  else if(name==='stars'){
    ctx.fillStyle='#000008';ctx.fillRect(0,0,w,h);
    for(let i=0;i<150;i++){
      const sx=Math.random()*w,sy=Math.random()*h,sr=0.5+Math.random()*2;
      ctx.fillStyle=`rgba(255,255,255,${0.3+Math.random()*0.7})`;
      ctx.beginPath();ctx.arc(sx,sy,sr,0,Math.PI*2);ctx.fill();
    }
    // Nebula glow
    for(let i=0;i<3;i++){
      const ng=ctx.createRadialGradient(Math.random()*w,Math.random()*h,0,Math.random()*w,Math.random()*h,150);
      ng.addColorStop(0,`hsla(${Math.random()*360},80%,50%,0.15)`);ng.addColorStop(1,'transparent');
      ctx.fillStyle=ng;ctx.fillRect(0,0,w,h);
    }
  }
  
  ctx.restore();drawDeckOutline();
}

// Image upload
let uploadedImage=null;
document.getElementById('imageUpload').onchange=e=>{
  const file=e.target.files[0];if(!file)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    const img=new Image();
    img.onload=()=>{
      uploadedImage=img;
      document.getElementById('imageThumb').src=ev.target.result;
      document.getElementById('imagePreview').style.display='block';
    };
    img.src=ev.target.result;
  };
  reader.readAsDataURL(file);
};
document.getElementById('imageMode').onchange=e=>{
  document.getElementById('applyImageBg').style.display=e.target.value==='background'?'block':'none';
};
document.getElementById('imageSize').oninput=e=>document.getElementById('imageSizeVal').textContent=e.target.value+'px';

function applyImageBackground(){
  if(!uploadedImage)return;
  saveState();
  ctx.save();deckClip();
  const scale=Math.max(C.width/uploadedImage.width,C.height/uploadedImage.height);
  const iw=uploadedImage.width*scale,ih=uploadedImage.height*scale;
  const ox=(C.width-iw)/2,oy=(C.height-ih)/2;
  ctx.drawImage(uploadedImage,ox,oy,iw,ih);
  ctx.restore();drawDeckOutline();
}

function placeImageSticker(x,y){
  if(!uploadedImage)return;
  saveState();
  const size=+document.getElementById('imageSize').value;
  const aspect=uploadedImage.width/uploadedImage.height;
  let iw,ih;
  if(aspect>=1){iw=size;ih=size/aspect}else{ih=size;iw=size*aspect}
  ctx.save();deckClip();
  ctx.drawImage(uploadedImage,x-iw/2,y-ih/2,iw,ih);
  ctx.restore();drawDeckOutline();
}

initDeck();

// === Gallery: Save/Share via URL hash + localStorage ===
const GALLERY_KEY='deckDesignerGallery';

function showToast(msg){
  let t=document.querySelector('.toast');
  if(!t){t=document.createElement('div');t.className='toast';document.body.appendChild(t)}
  t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2200);
}

function getCanvasData(){
  // Use JPEG at low quality for smaller URLs
  return C.toDataURL('image/jpeg',0.5);
}

function shareDesign(){
  const data=getCanvasData();
  // Strip data URL prefix, encode for hash
  const b64=data.split(',')[1];
  const url=window.location.origin+window.location.pathname+'#design='+encodeURIComponent(b64);
  if(url.length>50000){
    // Too large for URL, use smaller quality
    const small=C.toDataURL('image/jpeg',0.25).split(',')[1];
    const url2=window.location.origin+window.location.pathname+'#design='+encodeURIComponent(small);
    if(url2.length>100000){
      showToast('âš ï¸ Design too complex to share via URL. Try Export PNG instead.');
      return;
    }
    navigator.clipboard.writeText(url2).then(()=>showToast('ğŸ”— Share link copied!')).catch(()=>{
      window.location.hash='design='+encodeURIComponent(small);
      showToast('ğŸ”— URL updated â€” copy from address bar');
    });
    return;
  }
  navigator.clipboard.writeText(url).then(()=>showToast('ğŸ”— Share link copied!')).catch(()=>{
    window.location.hash='design='+encodeURIComponent(b64);
    showToast('ğŸ”— URL updated â€” copy from address bar');
  });
}

function loadFromHash(){
  const hash=window.location.hash;
  if(!hash.startsWith('#design='))return;
  const b64=decodeURIComponent(hash.slice(8));
  const img=new Image();
  img.onload=()=>{
    ctx.clearRect(0,0,C.width,C.height);
    ctx.save();deckClip();
    ctx.drawImage(img,0,0,C.width,C.height);
    ctx.restore();drawDeckOutline();
    showToast('ğŸ¨ Design loaded from shared link!');
  };
  img.src='data:image/jpeg;base64,'+b64;
}

function getGallery(){
  try{return JSON.parse(localStorage.getItem(GALLERY_KEY))||[]}catch(e){return[]}
}
function setGallery(g){localStorage.setItem(GALLERY_KEY,JSON.stringify(g))}

function saveToGallery(){
  const name=prompt('Name your design:','My Deck '+(getGallery().length+1));
  if(!name)return;
  const thumb=C.toDataURL('image/jpeg',0.4);
  const full=C.toDataURL('image/png');
  const g=getGallery();
  g.unshift({name,thumb,full,date:Date.now()});
  if(g.length>20)g.pop();
  setGallery(g);
  renderGallery();
  showToast('ğŸ“Œ Saved to gallery!');
}

function loadFromGallery(idx){
  const g=getGallery();
  if(!g[idx])return;
  saveState();
  const img=new Image();
  img.onload=()=>{
    ctx.clearRect(0,0,C.width,C.height);
    ctx.drawImage(img,0,0);
    showToast('Loaded: '+g[idx].name);
  };
  img.src=g[idx].full;
}

function deleteFromGallery(idx){
  const g=getGallery();
  g.splice(idx,1);
  setGallery(g);
  renderGallery();
}

function renderGallery(){
  const el=document.getElementById('galleryList');
  const g=getGallery();
  if(!g.length){el.innerHTML='<span style="font-size:.75rem;color:var(--text2)">No saved designs yet</span>';return}
  el.innerHTML=g.map((d,i)=>`<div class="gallery-item" onclick="loadFromGallery(${i})">
    <img src="${d.thumb}" alt="${d.name}">
    <div class="gallery-name">${d.name}</div>
    <button class="gallery-del" onclick="event.stopPropagation();deleteFromGallery(${i})">âœ•</button>
  </div>`).join('');
}

// Init: load from URL hash if present, render gallery
window.addEventListener('load',()=>{loadFromHash();renderGallery()});
window.addEventListener('hashchange',loadFromHash);
</script>
</body>
</html>
